"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(r){t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var o=function(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n="",o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=t[o],r=!1;break}return{isPc:r,facilityName:n}},i=function(){if(!document||!window)return{};var e=document,t=e.domain,r=e.URL,n=e.title,i=e.referrer,a=window.screen,s=a.height,c=a.width,d=a.colorDepth,u=navigator,l=u.language,f=u.platform;return{sendTypeName:"设备数据",isWx:!!navigator.userAgent.match(/MicroMessenger\/([^\s]+)/),pcInfo:o(),domain:t,url:r,title:n,referrer:i,screenW:c,screenH:s,screenColorDepth:d,language:l,platform:f}},a=window.performance||window.msPerformance||window.webkitPerformance,s=function(){var e,t,r,n,o,i,s,c,d,u,l,f,m,p,y;return{sendTypeName:"页面加载数据",timeOut:(e=a.getEntriesByType("resource"))?e.filter((function(e){var t=e.startTime;return e.responseEnd-t>5e3})).map((function(e){return{name:e.name,encodedBodySize:e.encodedBodySize,decodedBodySize:e.decodedBodySize,timeout:5e3,duration:e.duration,protocol:e.nextHopProtocol,type:e.initiatorType}})):[],timeData:(t=a.timing?a.timing:a.getEntriesByType("navigation"),r=t.fetchStart,n=t.domainLookupStart,o=t.domainLookupEnd,i=t.connectStart,s=t.connectEnd,c=t.secureConnectionStart,d=t.requestStart,u=t.responseStart,l=t.responseEnd,f=t.domInteractive,m=t.domContentLoadedEventStart,p=t.domContentLoadedEventEnd,y=t.loadEventStart,{fpt:l-r,tti:f-r,ready:m-r,load:y-r,firstbyte:u-n,dns:o-n,tcp:s-i,ttfb:u-d,trans:l-u,dom:f-l,res:y-p,sslTime:c?s-c:null})}},c=function(e){if(e){var t=e.target;return{sendTypeName:"资源加载错误",tagName:t.tagName.toLowerCase(),src:t.getAttribute("src")}}},d=function(e){var t,r=e.message,n=e.filename,o=e.lineno,i=e.colno,a=e.reason,s=e.type,c=e.error;return r?r.toLowerCase().includes("script error")?{sendTypeName:"普通脚本错误1",message:r}:{sendTypeName:"普通脚本错误2",message:r,filename:n,lineno:o,colno:i,stack:null==c||null===(t=c.stac)||void 0===t?void 0:t.toString(),type:s}:{sendTypeName:"promise 错误",type:s,reason:null==a?void 0:a.toString(),message:null==a?void 0:a.message,stack:null==a?void 0:a.stack}},u=new(function(){function t(e){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.key=e.key,this.userData={browser:{title:"页面初始化"},timeData:{}},this.methods={resourceErrorHandler:c,scriptErrorHandler:d,promiseErrorHandler:d},this.plugins={},this.init=function(){var e=window.onload;window.onload=function(t){e&&"function"==typeof e&&e(t),window.requestIdleCallback=window.requestIdleCallback||setTimeout,window.requestIdleCallback((function(){r.userData={browser:i(),timeData:s()}}))}},this.init()}var r,o,a;return r=t,(o=[{key:"eventMethod",value:function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.methods[r]||this.plugins[r];e.addEventListener(t,(function(e){n.sendData(i(e))}),o)}},{key:"register",value:function(e){var t=e.name,r=e.func;this.plugins[t]=r}},{key:"sendData",value:function(e){return console.log(n(n({},e),{title:this.userData.browser.pcInfo,key:this.key})),e}}])&&e(r.prototype,o),a&&e(r,a),t}())({key:"my-record"});u.eventMethod(document,"error","resourceErrorHandler",!0),u.eventMethod(window,"error","scriptErrorHandler",!1),u.eventMethod(window,"unhandledrejection","promiseErrorHandler",!1),module.exports=u;
